<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>
  <body>
9.4	Custom generators
The project may require very specific generators in order to mimic a real-world device. The approach of ModbusPal is to let the user create its own generators thanks to scripts.
To add scripted generators, summon the script manager dialog by clicking on the “…” button.

In order to add scripted generators, summon the script manager dialog by clicking on “…”
Refer to chapter §11 for more information.

Scripted generators
Overview
Writing a scripted generator consists of subclassing the PythonGenerator Java class in a Python class. The magic of interpreting the Python class is made by the Jython interpreter.
Important: Make sure that the name of the Python class matches the name of the file containing the script. For example, the script that defines a “CustomGenerator” class must be named “CustomGenerator.py”.
A scripted generator should only contain a class definition, this class being a subclass of PythonGenerator.
Minimalist generator script
The PythonGenerator class has no abstract member, so there is no obligation to implement any of its method.
The following example only overrides the “getValue” method, which is responsible of returning the dynamic value created by the generator.
The returned value is “time” itself, which means that the “getValue” method is equivalent to the mathematical function f(x)=x.

Content of “MinimalistGenerator.py”

from modbuspal.script import PythonGenerator

class MinimalistGenerator(PythonGenerator):

  def getValue(self,time):
    return time;


Advanced generator script
The following script illustrates all the aspects of a fully customized generator.
	It defines a new icon for display in the automation editor
	It creates a control panel for display in the automation editor, letting the user customize some parameters
	It generates a dynamic value of the f(x)=ax+b kind, where ‘a’ is a user-defined value and ‘b’ is the initial value of the generator.
	It saves some parameters with XML formatting into the project file
	It loads those parameters from the project file

Content of “AdvancedGenerator.py”

from modbuspal.script import PythonGenerator
from modbuspal.toolkit import NumericTextField
from modbuspal.toolkit import XMLTools
from java.awt import *
from javax.swing import *

class AdvancedGenerator(PythonGenerator):

  # Init function:
  # - set generator icon
  # - create the control panel
  def init(self):

    self.setIcon("./CustomGenerator.png");
    self.createCtrlPane();


  # This function will create a control panel using Java Swing components.
  # The control panel will appear in the middle of the generator panel,
  # in the automation editor.
  def createCtrlPane(self):

    self.ctrlPane = JPanel();
    self.ctrlPane.setLayout( FlowLayout() );

    self.ctrlPane.add( JLabel("A=") );
    self.aTextField = NumericTextField(1.0);
    self.ctrlPane.add( self.aTextField );


  # Override the getControlPanel function so that the
  # control panel created in the init function is returned
  def getControlPanel(self):

    return self.ctrlPane;


  # Return the generated value, f(x)=ax+b
  # where a is defined by the user (in the control panel)
  # and b is the initial value of the generator (that is the
  # current value of the automation when the generator starts).
  def getValue(self,x):

    a = float( self.aTextField.getDouble() );
    b = self.getInitialValue();
    return a*x+b;


  # Save the parameters of this generator with XML formatting into
  # the provided output stream.
  def saveSettings(self, out):

    out.write("<a value=\""+ self.aTextField.getText() +"\" />\r\n");


  # Load the parameters of this generator from the provided DOM structure.
  def loadSettings(self,nodes):

    node = XMLTools.getNode(nodes,"a");
    if not (node is None) :
      value = XMLTools.getAttribute("value",node);
      self.aTextField.setText(value);



  </body>
</html>
